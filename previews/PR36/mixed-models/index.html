<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MixedModels.jl integration · BoxCox</title><meta name="title" content="MixedModels.jl integration · BoxCox"/><meta property="og:title" content="MixedModels.jl integration · BoxCox"/><meta property="twitter:title" content="MixedModels.jl integration · BoxCox"/><meta name="description" content="Documentation for BoxCox."/><meta property="og:description" content="Documentation for BoxCox."/><meta property="twitter:description" content="Documentation for BoxCox."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BoxCox</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">BoxCox.jl Documentation</a></li><li class="is-active"><a class="tocitem" href>MixedModels.jl integration</a><ul class="internal"><li><a class="tocitem" href="#Fitting-the-Box-Cox-transformation"><span>Fitting the Box-Cox transformation</span></a></li><li><a class="tocitem" href="#Choosing-an-appropriate-transformation"><span>Choosing an appropriate transformation</span></a></li><li><a class="tocitem" href="#Fitting-a-model-to-the-transformed-response"><span>Fitting a model to the transformed response</span></a></li><li><a class="tocitem" href="#Impact-of-transformation"><span>Impact of transformation</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>MixedModels.jl integration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MixedModels.jl integration</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/palday/BoxCox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/palday/BoxCox.jl/blob/main/docs/src/mixed-models.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MixedModels.jl-integration"><a class="docs-heading-anchor" href="#MixedModels.jl-integration">MixedModels.jl integration</a><a id="MixedModels.jl-integration-1"></a><a class="docs-heading-anchor-permalink" href="#MixedModels.jl-integration" title="Permalink"></a></h1><p>BoxCox.jl supports finding fitting the Box-Cox transformation to a <code>LinearMixedModel</code> from MixedModels.jl. This support is done via a package extension and so the user pays no dependency or precompilation penalty when this functionality is not used.</p><p>Let us examine the classic sleepstudy dataset from MixedModels.jl. First, we load the necessary packages.</p><pre><code class="language-julia hljs">using BoxCox
using CairoMakie
using MixedModels
using MixedModels: dataset
CairoMakie.activate!(; type=&quot;svg&quot;)</code></pre><p>Then we fit the traditional model used reaction time as our dependent variable:</p><pre><code class="language-julia hljs">model = fit(MixedModel,
            @formula(reaction ~ 1 + days + (1 + days | subj)),
            dataset(:sleepstudy))</code></pre><table><tr><th align="left"></th><th align="right">Est.</th><th align="right">SE</th><th align="right">z</th><th align="right">p</th><th align="right">σ_subj</th></tr><tr><td align="left">&#40;Intercept&#41;</td><td align="right">251.4051</td><td align="right">6.6323</td><td align="right">37.91</td><td align="right">&lt;1e-99</td><td align="right">23.7805</td></tr><tr><td align="left">days</td><td align="right">10.4673</td><td align="right">1.5022</td><td align="right">6.97</td><td align="right">&lt;1e-11</td><td align="right">5.7168</td></tr><tr><td align="left">Residual</td><td align="right">25.5918</td><td align="right"></td><td align="right"></td><td align="right"></td><td align="right"></td></tr></table>
<h2 id="Fitting-the-Box-Cox-transformation"><a class="docs-heading-anchor" href="#Fitting-the-Box-Cox-transformation">Fitting the Box-Cox transformation</a><a id="Fitting-the-Box-Cox-transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-the-Box-Cox-transformation" title="Permalink"></a></h2><p>While this model does perform well overall, we can also examine whether the Box-Cox transformation suggests a transformation of the response.</p><pre><code class="language-julia hljs">bc = fit(BoxCoxTransformation, model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Box-Cox transformation

estimated λ: -1.0747
resultant transformation:

 y^-1.1 - 1
------------
    -1.1
</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>For large models, fitting the <code>BoxCoxTransformation</code> can take a while because a mixed model must be repeatedly fit after each intermediate transformation.</p></div></div><h2 id="Choosing-an-appropriate-transformation"><a class="docs-heading-anchor" href="#Choosing-an-appropriate-transformation">Choosing an appropriate transformation</a><a id="Choosing-an-appropriate-transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Choosing-an-appropriate-transformation" title="Permalink"></a></h2><p>Although we receive a single &quot;best&quot; value (approximately -1.0747) from the fitting process, it is worthwhile to look at the profile likelihood plot for the transformation:</p><pre><code class="language-julia hljs">boxcoxplot(bc; conf_level=0.95)</code></pre><img src="202150d7.svg" alt="Example block output"/><p>Here we see that -1 is nearly as good. Moreover, time<span>$^{-1}$</span> has a natural interpretation as <em>speed</em>. In other words, we can model reaction speed instead of reaction time. Then instead of seeing whether participants take longer to respond with each passing day, we can see whether their speed increases or decreases. In both cases, we&#39;re looking at whether they respond <em>faster</em> or <em>slower</em> and even the terminology <em>fast</em> and <em>slow</em> suggests that speed is easily interpretable.</p><p>Now, the formal definition of the Box-Cox transformation is:</p><p class="math-container">\[\begin{cases}
\frac{x^{\lambda} - 1}{\lambda} &amp;\quad \lambda \neq 0 \\
\log x &amp;\quad \lambda = 0
\end{cases}\]</p><p>In other words, there is a normalizing denominator that flips the sign when <span>$\lambda &lt; 0$</span>. If we use the full Box-Cox formula, then the sign of the effect in our transformed and untransformed model remains the same. While useful at times, speed has a natural interpretation and so we instead use the power relation, which is the actual key component, without normalization.</p><h2 id="Fitting-a-model-to-the-transformed-response"><a class="docs-heading-anchor" href="#Fitting-a-model-to-the-transformed-response">Fitting a model to the transformed response</a><a id="Fitting-a-model-to-the-transformed-response-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-a-model-to-the-transformed-response" title="Permalink"></a></h2><p>Because <code>reaction</code> is stored in milliseconds, we use <code>1000 / reaction</code> instead of <code>1 / reaction</code> so that our speed units are responses per second.</p><pre><code class="language-julia hljs">model_bc = fit(MixedModel,
               @formula(1000 / reaction ~ 1 + days + (1 + days | subj)),
                dataset(:sleepstudy))</code></pre><table><tr><th align="left"></th><th align="right">Est.</th><th align="right">SE</th><th align="right">z</th><th align="right">p</th><th align="right">σ_subj</th></tr><tr><td align="left">&#40;Intercept&#41;</td><td align="right">3.9658</td><td align="right">0.1056</td><td align="right">37.55</td><td align="right">&lt;1e-99</td><td align="right">0.4190</td></tr><tr><td align="left">days</td><td align="right">-0.1110</td><td align="right">0.0151</td><td align="right">-7.37</td><td align="right">&lt;1e-12</td><td align="right">0.0566</td></tr><tr><td align="left">Residual</td><td align="right">0.2698</td><td align="right"></td><td align="right"></td><td align="right"></td><td align="right"></td></tr></table>
<p>For our original model on the untransformed scale, the intercept was approximately 250, which means that the average response time was about 250 milliseconds. For the model on the speed scale, we have an intercept about approximately 4, which means that the average response speed is about 4 responses per second, which implies that the the average response time is 250 milliseconds. In other words, our new results are compatible with our previous estimates.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Because the Box-Cox transformation helps a model achieve normality of the <em>residuals</em>, it helps fulfill the model assumptions. When these assumptions are not fulfilled, we may still get similar estimates, but the standard errors and derived measures (e.g., confidence intervals and associated coverage) may not be correct.</p></div></div><p>Finally, let&#39;s take a look at our the residual diagnostics for our transformed and untransformed models:</p><h2 id="Impact-of-transformation"><a class="docs-heading-anchor" href="#Impact-of-transformation">Impact of transformation</a><a id="Impact-of-transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Impact-of-transformation" title="Permalink"></a></h2><pre><code class="language-julia hljs">let f = Figure()
    ax = Axis(f[1, 1]; title=&quot;Reaction Time&quot;, aspect=1)
    density!(ax, residuals(model))
    ax = Axis(f[1, 2]; title=&quot;Speed&quot;, aspect=1)
    density!(ax, residuals(model_bc))
    colsize!(f.layout, 1, Aspect(1, 1.0))
    colsize!(f.layout, 2, Aspect(1, 1.0))
    resize_to_layout!(f)
    f
end</code></pre><img src="77b9f8cb.svg" alt="Example block output"/><h3 id="QQ-plots"><a class="docs-heading-anchor" href="#QQ-plots">QQ plots</a><a id="QQ-plots-1"></a><a class="docs-heading-anchor-permalink" href="#QQ-plots" title="Permalink"></a></h3><pre><code class="language-julia hljs">let f = Figure()
    ax = Axis(f[1, 1]; title=&quot;Reaction Time&quot;, aspect=1)
    qqnorm!(ax, residuals(model); qqline=:fitrobust)
    ax = Axis(f[1, 2]; title=&quot;Speed&quot;, aspect=1)
    qqnorm!(ax, residuals(model_bc); qqline=:fitrobust)
    colsize!(f.layout, 1, Aspect(1, 1.0))
    colsize!(f.layout, 2, Aspect(1, 1.0))
    resize_to_layout!(f)
    f
end</code></pre><img src="4f5b9a7e.svg" alt="Example block output"/><h3 id="Fitted-vs-residual"><a class="docs-heading-anchor" href="#Fitted-vs-residual">Fitted vs residual</a><a id="Fitted-vs-residual-1"></a><a class="docs-heading-anchor-permalink" href="#Fitted-vs-residual" title="Permalink"></a></h3><pre><code class="language-julia hljs">let f = Figure()
    ax = Axis(f[1, 1]; title=&quot;Reaction Time&quot;, aspect=1, xlabel=&quot;Fitted&quot;, ylabel=&quot;Residual&quot;)
    scatter!(ax, fitted(model), residuals(model))
    hlines!(ax, 0; linestyle=:dash, color=:black)
    ax = Axis(f[1, 2]; title=&quot;Speed&quot;, aspect=1, xlabel=&quot;Fitted&quot;, ylabel=&quot;Residual&quot;)
    scatter!(ax, fitted(model_bc), residuals(model_bc))
    hlines!(ax, 0; linestyle=:dash, color=:black)
    colsize!(f.layout, 1, Aspect(1, 1.0))
    colsize!(f.layout, 2, Aspect(1, 1.0))
    resize_to_layout!(f)
    f
end</code></pre><img src="f020a7bd.svg" alt="Example block output"/><h3 id="Fitted-vs-observed"><a class="docs-heading-anchor" href="#Fitted-vs-observed">Fitted vs observed</a><a id="Fitted-vs-observed-1"></a><a class="docs-heading-anchor-permalink" href="#Fitted-vs-observed" title="Permalink"></a></h3><pre><code class="language-julia hljs">let f = Figure()
    ax = Axis(f[1, 1]; title=&quot;Reaction Time&quot;, aspect=1,
              xlabel=&quot;Fitted&quot;, ylabel=&quot;Observed&quot;)
    scatter!(ax, fitted(model), response(model))
    ablines!(ax, 0, 1; linestyle=:dash, color=:black)
    ax = Axis(f[1, 2]; title=&quot;Speed&quot;, aspect=1, xlabel=&quot;Fitted&quot;, ylabel=&quot;Observed&quot;)
    scatter!(ax, fitted(model_bc), response(model_bc))
    ablines!(ax, 0, 1; linestyle=:dash, color=:black)
    colsize!(f.layout, 1, Aspect(1, 1.0))
    colsize!(f.layout, 2, Aspect(1, 1.0))
    resize_to_layout!(f)
    f
end</code></pre><img src="40de0275.svg" alt="Example block output"/><p>All together, this suggests that using speed instead of reaction time does indeed improve the quality of the model fit, even though the fit was already very good for reaction time. This example also highlighted the importance of the analyst&#39;s discretion: we choose a slightly different transformation than the originally estimated Box-Cox transformation in order to yield a model on a naturally interpretable scale.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« BoxCox.jl Documentation</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 17 January 2025 03:52">Friday 17 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
